<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hang Man</title>
</head>
<body>

<button onclick="resetGame()">Start game!</button>

<h1>Hang Man</h1>

<!--Update id-->

<h1 id="wrongGuesses"></h1>

<img src="images/hang_man_1.png" alt="Cat" width="750" height="420">

<h1 id="wordHeader"></h1>

<form>
    Guess a letter:<br>
    <input type="text" id="textField" name="letter" value="">
    <br><br>
    <input type="button" onclick="submitGuess()" value="Submit">
</form>

<script>

    function resetGame() {
        setupData();
        setupUI();
    }

    function setupData() {
        generateRandomWord();
        generateGuessedWord();
        setWrongGuessesString("");
    }

    function setupUI() {
        updateWordHeader();
    }

    function submitGuess() {
        // TODO: make helper func.
        const guess = document.getElementById("textField").value;
        if (guess.length > 1) {
            // Show error.
        } else if (getWrongGuessesString().includes(guess) || getGuessedWord().includes(guess)) {
            // Handle already guessed.
        } else {
            handleGuess(guess);
        }
        updateWordHeader();
        updateWrongGuessesHeader();
        clearGuessField();
    }

    function handleGuess(guess) {
        if (getRandomWord().includes(guess)) {
            handleCorrectGuess(guess);
        } else {
            addLetterToWrongGuesses(guess);
        }
    }

    function handleCorrectGuess(guess) {
        let randomWord = getRandomWord();
        let guessedWordArray = getGuessedWord().split('');
        for(var i=0; i<randomWord.length; i++) {
            if (randomWord[i] === guess) {
                guessedWordArray[i] = guess;
            }
        }
        let joinedGuessedWordArray = guessedWordArray.join('');
        setGuessedWord(joinedGuessedWordArray);
    }

    function updateWordHeader() {
        document.getElementById("wordHeader").innerText = getGuessedWord();
    }

    function updateWrongGuessesHeader() {
        document.getElementById("wrongGuesses").innerText = getWrongGuessesString();
    }

    function clearGuessField() {
        document.getElementById("textField").value = "";
    }

    function generateRandomWord() {
        const randomWord = pickRandomWordFromList();
        setRandomWord(randomWord);
    }

    function generateGuessedWord() {
        var guessedWord = "";
        const randomWord = getRandomWord();
        for (let letter of randomWord) {
            guessedWord = guessedWord + "-";
        }
        setGuessedWord(guessedWord);
    }

    function pickRandomWordFromList() {
        const randomWordList = ["cat","dog","foo","bar"];
        const randomWord = randomWordList[Math.floor(Math.random() * randomWordList.length)];
        return randomWord;
    }

    function setRandomWord(randomWord) {
        localStorage.setItem("randomWord", randomWord);
    }

    function getRandomWord() {
        return localStorage.getItem("randomWord");
    }

    function setGuessedWord(guessedWord) {
        localStorage.setItem("guessedWord", guessedWord);
    }

    function getGuessedWord() {
        return localStorage.getItem("guessedWord");
    }

    function setWrongGuessesString(wrongGuesses) {
        localStorage.setItem("wrongGuessesString", wrongGuesses);
    }

    function getWrongGuessesString() {
        return localStorage.getItem("wrongGuessesString");
    }

    function addLetterToWrongGuesses(letter) {
        let wrongGuesses = getWrongGuessesString() + letter;
        setWrongGuessesString(wrongGuesses);
    }
</script>

</body>
</html>